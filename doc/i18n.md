# Internationalization (i18n) Implementation Guide

This document explains how the internationalization (i18n) system is implemented in the Call-me application.

## Overview

The application now supports multiple languages using a JSON-based translation system. The implementation follows best practices from the Crowdin Node.js i18n guide.

## Supported Languages

- **English (en)** - Default
- **Spanish (es)**
- **French (fr)**
- **Italian (it)**
- **German (de)**

## Architecture

### Backend (Server-side)

#### Dependencies

- **i18n**: Node.js internationalization library

#### Configuration

The i18n module is configured in [app/server.js](app/server.js):

```javascript
i18n.configure({
    locales: ['en', 'es', 'fr', 'it', 'de'],
    defaultLocale: 'en',
    directory: path.join(__dirname, '../locales'),
    objectNotation: true,
    updateFiles: false,
    syncFiles: false,
});
```

#### API Endpoint

**GET** `/translations/:locale`

Returns translations for the specified locale:

```json
{
    "locale": "en",
    "translations": {
        "appName": "Call-me",
        "signIn": {
            "title": "Sign In",
            "username": "Enter username"
        }
    }
}
```

### Frontend (Client-side)

#### Core Files

- **[public/i18n.js](public/i18n.js)**: Client-side i18n library
- **[app/locales/\*.json](app/locales/)**: Translation files

#### Key Features

1. **Automatic Language Detection**
    - Checks localStorage for saved preference
    - Falls back to browser language
    - Defaults to English if unsupported

2. **Translation Function**

    ```javascript
    t('signIn.username'); // Returns: "Enter username"
    t('room.userJoined', { username: 'John' }); // Returns: "John joined the call"
    ```

3. **HTML Attributes**
    - `data-i18n`: Translates element text content
    - `data-i18n-placeholder`: Translates input placeholder
    - `data-i18n-title`: Translates element title/tooltip

4. **Language Switcher**
   Located in the Settings tab, allows users to change language in real-time. Each language option is displayed with its corresponding flag emoji (ðŸ‡¬ðŸ‡§ English, ðŸ‡ªðŸ‡¸ EspaÃ±ol, ðŸ‡«ðŸ‡· FranÃ§ais, ðŸ‡®ðŸ‡¹ Italiano, ðŸ‡©ðŸ‡ª Deutsch) for easy visual identification.

## Translation Files Structure

All translation files are located in the `app/locales/` directory:

```
app/locales/
â”œâ”€â”€ en.json  # English
â”œâ”€â”€ es.json  # Spanish
â”œâ”€â”€ fr.json  # French
â”œâ”€â”€ it.json  # Italian
â””â”€â”€ de.json  # German
```

### JSON Structure

```json
{
    "appName": "Call-me",
    "appTitle": "Call-me - Instant Video Calls",
    "signIn": {
        "title": "Sign In",
        "username": "Enter username",
        "button": "Sign In"
    },
    "room": {
        "users": "Users",
        "chat": "Chat"
    },
    "settings": {
        "language": "Language",
        "selectLanguage": "Select Language"
    }
}
```

## Adding New Languages

1. Create a new JSON file in `app/locales/` directory (e.g., `app/locales/pt.json` for Portuguese)
2. Copy the structure from `app/locales/en.json` and translate all values
3. Update the server configuration in `app/server.js`:
    ```javascript
    i18n.configure({
        locales: ['en', 'es', 'fr', 'it', 'de', 'pt'], // Add 'pt'
        // ...
    });
    ```
4. Update the frontend language selector in `public/i18n.js`:
    ```javascript
    const supportedLocales = ['en', 'es', 'fr', 'it', 'de', 'pt']; // Add 'pt'
    ```
5. Add the option to the language selector in `public/index.html` with the appropriate flag emoji:
    ```html
    <option value="pt">ðŸ‡µðŸ‡¹ PortuguÃªs</option>
    ```

## Adding New Translation Keys

1. Add the key to all language files in `locales/`:

    ```json
    {
        "newSection": {
            "newKey": "Translation text"
        }
    }
    ```

2. Use in HTML with data attributes:

    ```html
    <button data-i18n="newSection.newKey">Default Text</button>
    ```

3. Or use in JavaScript:
    ```javascript
    const text = t('newSection.newKey');
    ```

## Dynamic Text Replacement

For translations with dynamic values, use placeholder syntax:

**Translation file:**

```json
{
    "room": {
        "userJoined": "__username__ joined the call"
    }
}
```

**Usage:**

```javascript
const message = t('room.userJoined', { username: 'Alice' });
// Result: "Alice joined the call"
```

## Best Practices

1. **Key Naming**: Use dot notation for nested keys (e.g., `settings.language`)
2. **Consistency**: Keep the same structure across all language files
3. **Placeholders**: Use `__placeholder__` format for dynamic values
4. **Fallbacks**: Always provide English translations as fallback
5. **Context**: Group related translations under common parent keys

## Testing

To test the implementation:

1. Start the server:

    ```bash
    npm start
    ```

2. Open the application in a browser
3. Navigate to Settings tab
4. Select different languages from the dropdown
5. Verify that UI elements update correctly

## Integration with Crowdin

To use with Crowdin for collaborative translation:

1. Install Crowdin CLI: `npm install -g @crowdin/cli`
2. Create a `crowdin.yml` configuration file
3. Upload source files: `crowdin upload sources`
4. Download translations: `crowdin download`

## API Documentation

The translations endpoint is documented in the Swagger API documentation under `/api/v1/docs`.

## Troubleshooting

**Issue**: Translations not loading

- Check browser console for errors
- Verify the locale file exists in `locales/` directory
- Ensure the API endpoint is accessible

**Issue**: Some text not translating

- Verify the HTML element has the correct `data-i18n` attribute
- Check that the translation key exists in the locale file
- Ensure `translatePage()` is called after DOM updates

**Issue**: Language not persisting

- Check browser localStorage
- Ensure the locale is in the `supportedLocales` array

## Future Enhancements

- Add more languages (Portuguese, Chinese, Japanese, etc.)
- Implement pluralization support
- Add date/time localization
- Support RTL languages (Arabic, Hebrew)
- Add translation management UI
- Integrate with professional translation services

## Resources

- [i18n npm package](https://www.npmjs.com/package/i18n)
- [Crowdin Node.js i18n Guide](https://crowdin.com/blog/nodejs-i18n-and-localization)
- [IANA Language Subtag Registry](https://www.iana.org/assignments/language-subtag-registry)
